name: Deploy to Donweb Cloud

on:
    push:
        branches:
            - master
jobs:
    deploy:
        runs-on: ubuntu-22.04
        steps:
            - name: Echo the message    
              run: echo "Hola Santiago"
            - name: Checkout 
              uses: actions/checkout@v4
              with:
                fetch-depth: 0
            - name: Node
              uses: actions/setup-node@v4
              with: 
                node-version: 18.20.4
            - name: Install server
              run: npm i --no-audit --no-fund --no-optional
            - name: Install client
              run: npm i --prefix client
            - name: Build client
              run: npm run build --prefix client
            - name: Create .tar deploy file
              run: | 
                mkdir ../build
                cp -TR . ../build
                tar -cvf deploy.tar ../build/
            - name: Copy ssh
              uses: appleboy/scp-action@v0.1.7
              with:
                host: ${{ secrets.DESTINATION_HOST }}
                username: ${{ secrets.SSH_USERNAME }}
                password: ${{ secrets.SSH_PASSWORD }}
                port: ${{ secrets.DESTINATION_SSH_PORT }}
                source: "deploy.tar"
                target: ${{ secrets.DESTINATION_FOLDER }}
                